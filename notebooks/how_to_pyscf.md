# How to write Pyscf output into Trexio format

This tutorial shows how to use Pyscf (https://pyscf.org/) to save computational results in TREXIO format. 

## Importing TREXIO

Trexio is avialble throught the pyscf-forge repository.(https://github.com/pyscf/pyscf-forge). After installing PySCF-FORGE, you can access the TREXIO library within PySCF using the following import statement:

```python
import pyscf.tools import *
```

## How to register RHF results

Once a molecule is defined, you can register the Restricted Hartree-Fock (RHF) results into TREXIO. In this tutorial, the HDF5 backend is used to store the results.

```python
# Perform RHF calculation
mf = scf.RHF(mol)
mf.kernel()

# Save results in TREXIO format
trexio_file = 'rhf.hdf5'
to_trexio(mf, trexio_file)
```
The ```to_trexio``` function saves various data, including the basis set, molecular specifications, and molecular orbitals, into the TREXIO file.

## Storing Two-Electron Integrals
 
If required, you can also register the two-electron integrals in MO basis using the following commands:

```python
# Compute two-electron integrals
eri = mol.into('int2e')

# Compute two-electron integrals
write_eri(eri, trexio_file)
```

## Saving determinants after a sCI or FCI calculations

You may want to register a determinant list after a CASCI/CASSCF, selected CI (sCI), or full CI (FCI) calculation. To avoid inconsistencies, it is recommended to save this data in a separate TREXIO file from the one used for RHF results.


```python
norb = 10
nelec = 4
                          
# Initialize CASCI calculation with Selected CI as the solver
mcscf = mcscf.casci_symm.CASCI(mf, norb, nelec)
mcscf.fcisolver = selected_ci_spin0_symm.SelectedCI(rhf)

#Perform  CASCI calculation
mcscf.kernel()
 
#Save determinants into trexio
trexio_file = 'my_det.hdf5'
det_to_trexio(mcscf, norb, nelec, trexio_file)
```

The ```det_to_trexio``` function registers the number of MO, number of alpha and beta electrions, total number of determinants, coefficients and the determinants in bitfield format.

## Applying a Threshold for Determinants
You can filter determinants by their coefficients, saving only those that exceed a specified threshold:

```python
# Define a coefficient threshold
ci_threshold = 1e-1

# Save filtered determinants to a TREXIO file
trexio_file = 'filtered_determinants.hdf5'
det_to_trexio(casci, norb, nelec, trexio_file, ci_threshold = ci_threshold )
```

This approach allows to filter determinants based on their importance, reducing the size of the output file and focusing on significant contributions.

## Inspecting Determinants and Coefficients
You can retrieve and display the determinants and coefficients directly using the following code:

```python
from itertools import islice

# Retrieve determinants and coefficients
occsa, occsb, ci_coeffs,num_determinants = get_occsa_and_occsb(casci, norb, nelec, ci_threshold = ci_threshold)

# Print the first 10 determinants
for a, b, coeff in islice(zip(occsa, occsb, ci_coeffs), 10):
    print(f"   {a}          {b}         {coeff}")
```
If no ```ci_threshold``` is provided, the function processes the full list of determinants by default

## Read determinant from TREXIO
You may also want to import determinant information from a TREXIO file generated by other software. This can be done using the following code:

```python
num_det, coeff, det_list = read_det_trexio(trexio_file)
```
It retrives the number of determinantm coefficient and determinant list in bitfield format
This data can then be analyzed or used in subsequent computations.
